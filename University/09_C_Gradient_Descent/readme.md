 Градиентный спуск или что-то похожее на него, непонятный код - переделать полностью. ;)
